# 如何与知识库聊天

## 🎯 快速开始

### 方法 1: 交互式选择任务

```bash
python -m src.cli.main chat interactive
```

系统会显示所有可用任务，您可以选择一个进行对话。

### 方法 2: 直接指定任务

```bash
python -m src.cli.main chat interactive --task news-jj2
```

直接与指定任务的知识库对话。

---

## 💬 使用示例

### 启动对话

```bash
$ python -m src.cli.main chat interactive --task news-jj2

╭──────────────────────────────────╮
│ 与任务 'news-jj2' 的知识库对话  │
│ 输入 'exit' 或 'quit' 退出       │
╰──────────────────────────────────╯

你: 最近有什么重要的经济新闻？
```

### 系统工作流程

1. **混合搜索** - 使用 75% 语义 + 25% 关键词搜索相关新闻
2. **智能过滤** - 只返回相似度 ≥ 0.7 的结果
3. **上下文构建** - 将相关新闻片段组合成上下文
4. **LLM 回答** - 基于新闻内容生成准确回答

### 示例对话

```
你: 最近有什么重要的经济新闻？

助手: 根据最新的新闻，以下是几个重要的经济动态：

1. **理财市场变化** - 理财代销加速下沉，但需警惕收益率"美颜"陷阱
2. **金融政策** - 相关部门发布了新的金融监管政策
3. **市场动态** - A股市场出现新的变化趋势

参考了 5 个新闻片段

你: 详细说说理财市场的情况

助手: 关于理财市场，主要有以下几点：
...

你: exit

再见！
```

---

## ⚙️ 配置说明

### 搜索参数（在 `config/config.yaml` 中配置）

```yaml
weaviate:
  search:
    type: hybrid                # 搜索类型
    hybrid_alpha: 0.75          # 75% 语义 + 25% 关键词
    similarity_threshold: 0.7   # 相似度阈值
    max_results: 5              # 最多返回 5 个结果
```

### LLM 配置

```yaml
llm:
  provider: openai
  model: gpt-4
  temperature: 0.7
  api_key: your-api-key
  base_url: https://litellm.futurx.cc
```

---

## 🎨 功能特点

### 1. 混合搜索
- ✅ 结合语义理解和关键词匹配
- ✅ 提高搜索准确性
- ✅ 可调整权重

### 2. 智能过滤
- ✅ 相似度阈值过滤
- ✅ 只返回高相关内容
- ✅ 避免无关信息干扰

### 3. 上下文增强
- ✅ 显示新闻来源
- ✅ 显示相关度分数
- ✅ 显示包含的文章数量

### 4. 实时对话
- ✅ 交互式问答
- ✅ Markdown 格式化输出
- ✅ 显示参考来源

---

## 📊 搜索质量对比

| 搜索方式 | 准确性 | 召回率 | 适用场景 |
|---------|--------|--------|----------|
| 纯语义搜索 | ⭐⭐⭐ | ⭐⭐⭐⭐ | 概念性问题 |
| 纯关键词搜索 | ⭐⭐⭐⭐ | ⭐⭐⭐ | 精确匹配 |
| **混合搜索** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | **通用场景** |

---

## 🚀 高级用法

### 调整搜索权重

如果您想要更偏向关键词匹配：

```yaml
weaviate:
  search:
    hybrid_alpha: 0.5  # 50% 语义 + 50% 关键词
```

如果您想要更偏向语义理解：

```yaml
weaviate:
  search:
    hybrid_alpha: 0.9  # 90% 语义 + 10% 关键词
```

### 调整结果数量

```yaml
weaviate:
  search:
    max_results: 10  # 返回更多结果
```

### 调整相似度阈值

```yaml
weaviate:
  search:
    similarity_threshold: 0.6  # 降低阈值，返回更多结果
```

---

## 💡 使用技巧

1. **提问要具体** - 越具体的问题，搜索结果越准确
2. **使用关键词** - 包含重要关键词可以提高匹配度
3. **多轮对话** - 可以基于上一个回答继续提问
4. **查看来源** - 注意查看"参考了 X 个新闻片段"了解信息来源

---

## 🔍 故障排查

### 问题 1: 找不到相关新闻

**原因**: 相似度阈值太高或问题与知识库内容不匹配

**解决**: 
- 降低 `similarity_threshold`
- 使用更通用的关键词
- 确认任务已成功采集新闻

### 问题 2: 回答不准确

**原因**: 搜索结果不够相关

**解决**:
- 调整 `hybrid_alpha` 参数
- 增加 `max_results` 数量
- 使用更具体的问题

---

## ✅ 完整示例

```bash
# 1. 查看所有任务
python -m src.cli.main rerun

# 2. 开始对话
python -m src.cli.main chat interactive --task news-jj2

# 3. 提问示例
你: 最近有什么重要的国际新闻？
你: 经济政策有什么变化？
你: 科技领域有什么突破？
你: exit
```

现在您可以开始与您的知识库对话了！🎉
